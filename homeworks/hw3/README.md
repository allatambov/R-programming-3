Домашнее задание 3
================
Алла Тамбовцева

Формат сдачи
------------

*Срок сдачи:*

19 декабря 2017, 22:00

*Формат сдачи:*

Студенту необходимо на выбор выполнить задачи базового или продвинутого блока. Результат выполнения домашнего задания 3: файл с расширением `.R`. Этот файл нужно загрузить по [ссылке](https://www.dropbox.com/request/E6iKGzo31bNaFH2M67Ua).

Базовый блок
------------

Скачайте с GitHub файл `hw3-rcode.R`, переименуйте его `hw3-rcode-surname.R`, где `surname` - Ваша фамилия латиницей. Откройте этот файл в R - в него Вы будете вписывать код для задач.

**Полезный факт:** загружать базу данных можно прямо по ссылке, не скачивая ее, если ссылка заканчивается расширением файла (например, `https://..../myfile.csv`). Для этого нужно вставить ссылку в качестве аргумента функции, используемой для загрузки файла.

### Задание 1

1.  Скачайте с сайта [British Election Study](http://www.britishelectionstudy.com/data-objects/cross-sectional-data/) базу данных Face-to-face Post-election Survey (2015) в формате `dta` (STATA File). Загрузите в R эту базу данных. Посмотрите на нее.
2.  Сохраните эту базу данных в формате `csv`, указав в качестве разделителя точку с запятой (возможно, потребуется запросить help для `write.csv()`).

*Для выполнения заданий 2-4 Вам необходимо загрузить [базу данных](https://raw.githubusercontent.com/vincentarelbundock/Rdatasets/master/csv/datasets/Titanic.csv), содержащую информацию по пассажирам "Титаника". Описание базы данных можно почитать [здесь](https://raw.githubusercontent.com/vincentarelbundock/Rdatasets/master/doc/datasets/Titanic.html). Назовите загруженную базу данных `df`.*

### Задание 2

*Примечание: если библиотеки для работы с пропущенными значениями (mice, VIM) не установились, как нужно:*

*  *в пунктах 3-4 напишите код, который по идее должен работать (нестрашно, если Вы сами сразу не можете его запустить)*

* *прогоните этот код на другом компьютере (в компьютерном классе) или на ноутбуке однокурсника (не сломайте ноутбук однокурсника!)*

* *получите необходмые графики и ответьте по ним на вопросы задания (в комментарии укажите, как выглядит проблема с библиотеками или пришлите мне скрин с ошибками по почте)*

1.  Сколько в базе данных наблюдений? Сколько переменных? Какие это переменные? Какого типа?
2.  Сколько в базе данных строк, которые не содержат пропущенных значений? Сохраните строки, содержащие пропущенные значения, в отдельную базу данных `df_na`.
3.  Постройте график, который показывал бы частоту, с которой встречаются пропущенные значения в каждой из переменных базы данных. В какой переменной больше всего пропущенных значений?
4.  Постройте график, который позволит определить паттерны пропущенных значений. Можно ли по полученным результатам сделать вывод о том, что значения в базе пропущены “системно” (часто нет ответов на определенный вопрос или вопросы)? Может ли это быть связано со спецификой самих вопросов?
5.  Удалите в базе данных пропущенные значения.

### Задание 3

*Это задание выполняется без использования библиотеки `dplyr`*.

1.  Добавьте в базу данных бинарную переменную `female`, где значение 0 соответствует пассажирам мужского пола, а 1 - пассажирам женского пола. Не забудьте: бинарная переменная - всегда числовая (целочисленная). Готовую переменную `SexCode` использовать нельзя.

2.  Представьте, что в исследовании нас интересуют пассажиры старше 25 лет и не старше 45 лет, которые путешествовали вторым или третьим классом. Сохраните соответствующие строки в базу данных `df2`.

3.  Сколько на "Титанике" (согласно базе данных `df`) было пассажиров мужского пола? Женского пола?

4.  Сколько лет было самому молодому пассажиру среди выживших? А самому старому? Каков средний возраст пассажиров первого класса, которые выжили в катастрофе?

### Задание 4

*Для выполнения этого задания нужно обязательно использовать библиотеку `dplyr`, а также оператор %&gt;% из этой библиотеки. Ответы на вопросы должны выглядеть так: код для получения ответа на вопрос и ответ словами в виде комментария.*

1.  Добавьте в базу данных `df` числовую переменную `ClassCode`, где значением 1 закодирован первый класс, 2 - второй, 3 - третий. Сделайте переменную `Age` целочисленной (integer).

2.  Оставьте в базе данных только тех пассажиров, которые не моложе 18 лет.

3.  Сгруппируйте пассажиров по классу, которым они путешествовали. Сколько пассажиров разных классов было на "Титанике"?

4.  В каком классе средний возраст выживших пассажиров выше?

5.  Кого больше: выживших мужчин из первого класса или выживших женщин из третьего класса?

Продвинутый блок
----------------

Для выполнения этого задания Вам нужно будет поработать с API Facebook.


**Часть 1**

 1. Установите библиотеку `RFacebook`. Устанавливается она с Github, см. код [здесь](https://github.com/pablobarbera/Rfacebook). Ознакомьтесь с [документацией](https://cran.r-project.org/web/packages/Rfacebook/Rfacebook.pdf) по этой библиотеке и [инструкцией](http://thinktostart.com/analyzing-facebook-with-r/) по авторизации. Авторизуйтесь согласно инструкции. 

     **Замечание:** если действовать точно по инструкции, есть шанс получить ошибку (Facebook не найдет домен с localhost). Поэтому в созданном приложении, в блоке *Вход через Facebook* в разделе *Клиентские настройки OAuth* нужно включить авторизацию OAuth и в поле для URL-адресов для перенаправления OAuth скопировать полный адрес с localhost. Поле *Домены приложений* в основных настройках оставить пустым.

2. Выберите какую-нибудь страницу (пользователь, сообщество, СМИ) в Facebook. Необходимо выбрать публичную страницу или страницу с большим количеством публичных постов.

3.  Используя функции `RFacebook`, сгрузите не менее 100 постов со страницы, сохраните их в базу данных `page`. База данных должна включать все столбцы, которые `RFacebook` создает по умолчанию (from\_id, from_name, message, created\_time и так далее.)

**Часть 2**

1. Установите библиотеки `tm` и `topicmodels`. 

2. Почитайте, если еще не знакомы, про меру [TF-IDF](https://ru.wikipedia.org/wiki/TF-IDF), латентное размещение Дирихле ([LDA](https://en.wikipedia.org/wiki/Latent_Dirichlet_allocation)) и его применение в тематическом моделировании. 

3. Выберите столбец с постами (*messages*), далее Вы будете работать с ним. Этот столбец - вектор, состоящий из текстов. Создайте из этих текстов корпус и выполните их предварительную обработку: уберите лишние символы, пунктуацию, [стоп-слова](https://en.wikipedia.org/wiki/Stop_words). Как это сделать -- см. [тьюториал](https://eight2late.wordpress.com/2015/09/29/a-gentle-introduction-to-topic-modeling-using-r/). 

4. Опираясь на тьюториал, указанный выше, создайте матрицу "документ-слова" (document-term matrix). Назовите строки этой матрицы именами строк в базе `pages`. 

5. Почитайте, если еще не знакомы, с [алгоритмом Гиббса](https://ru.wikipedia.org/wiki/%D0%A1%D0%B5%D0%BC%D0%BF%D0%BB%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5_%D0%BF%D0%BE_%D0%93%D0%B8%D0%B1%D0%B1%D1%81%D1%83) (Gibbs sampling). Его Вы будете использовать далее при реализации латентного размещения Дирихле. 

6. Пролистайте собранные Вами посты. Подумайте, сколько различных тем (*k*) можно выделить (например, "политика", "культура", "личное"). Опираясь на тьюториал, реализуйте латентное размещения Дирихле для собранных Вами постов и выбранного числа тем. В случае возникновения ошибок, возможно, этот [ответ](https://stackoverflow.com/questions/13944252/remove-empty-documents-from-documenttermmatrix-in-r-topicmodels) Вам поможет. Если пришлось воспользоваться этим советом, прежде, чем удалить проблемные строки в матрице, посмотрите, что это за строки, чтобы удалить их потом из базы `pages`.

7. Посмотрите на полученный результат. Совпадает ли полученное разделение на темы Вашим ожиданиям (и вообще здравому смыслу)? Если получилось что-то совсем странное, подумайте, из-за чего это могло произойти. Можете поиграть с параметрами (поменять число тем или метод семплирования), а также попробовать провести более качественную предобработку текстов (добавить свои стоп-слова, знаки пунктуации, удалять ссылки и не-русскоязычные фрагменты в текстах).

**Часть 3** 

Далее - все выполняется с помощью библиотеки `dplyr`.

1. Добавьте в базу `page` столбец `topic` - тема поста. Если темы получилсь осмысленные, добавьте текстовый столбец `topic_name` - короткое название темы.

2. Уберите из базы `page` столбцы `type`, `link`, `story`. 

3. Создайте столбец `date` на основе столбца `created_time`. В этом столбце должна храниться дата сообщения в формате "год-месяц-день" (например, "2017-12-11").

4. Сгруппируйте наблюдения в базе `pages` по дате публикации поста (`date`). В какой день среднее число лайков было максимальным? В какой день суммарное число репостов (то есть по всем постам за день) было наибольшим/наименьшим?

5. Сгруппируйте наблюдения по темам. Определите, сколько постов относятся к каждой теме. Создайте таблицу, которая содержала бы число постов по каждой теме по датам (дата 1 - число постов по теме 1, число постов по теме 2; дата 2 - число постов по теме 1, число постов по теме 2...).
