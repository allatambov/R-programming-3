Домашнее задание 4
================
Алла Тамбовцева

Формат сдачи
------------

*Срок сдачи:*

9 февраля 2018, 22:00

*Формат сдачи:*

Результат выполнения домашнего задания 4: файл с расширением `.Rmd`. Этот файл нужно загрузить по [ссылке](https://www.dropbox.com/request/YKbzyFqnMR7PL9Bwv4RG). Файл должен содержать код и ответы на вопросы (текст).

База данных `wgi_fh.csv` содержит показатели Worldwide Governance Indicators (WGI) и индекс Freedom House за 2016 год. Описание переменных:

-   X - id страны
-   country - название страны
-   cnt\_code - код страны (аббревиатура)
-   year - год
-   va - индекс Voice & Accountability (WGI)
-   ps - индекс Political Stability and Lack of Violence (WGI)
-   ge - индекс Government Effectiveness (WGI)
-   rq - индекс Regulatory Quality (WGI)
-   rl - индекс Rule of Law (WGI)
-   cc - индекс Control of Corruption (WGI)
-   fh - индекс Freedom House (Freedom Rating)

Подготовка базы данных
----------------------

1.  Загрузите базу данных `wgi_fh.csv`, учитывая, что в качестве разделителя столбцов используется точка с запятой.

2.  Посмотрите, каким образом в базе обозначены пропущенные значения. Замените все такие значения на "настоящие" пропущенные значения (NA).

    *Подсказка:* чтобы заменить определенные значения сразу во всей базе данных, можно поступить так -- пример для замены значений 100 на 1000: `df[df == 100] <- 1000`.

3.  Удалите в базе данных все пропущенные значения (NA). Сохраните базу данных в csv-файл `wgi_fh_new.csv`. Загрузите базу данных из файла `wgi_fh_new.csv` в R с учетом двух фактов:

    -   в качестве разделителя разрядов используется запятая (это нужно для того, чтобы R воспринимал записи вида "1,5" как числа, а не как текст);
    -   текстовые переменные из базы (strings) R должен считытывать как текстовые, а не как факторные (factor).

    Для выполнения этого пункта см. `?read.csv`.

4.  Удалите пропущенные значения из загруженной базы данных. Переименуйте столбец X, назовите его *id*.

    *Подсказка:* Функция `colnames()` выдает вектор с названиями столбцов. Чтобы изменить название одного столбца, нужно обратиться к элементу вектора с соответствующим индексом и присвоить ему новое значение.

5.  Используя материалы лекций, создайте три дамми-переменные `not_free`, `partly_free`, `free`. Для этого Вам потребуется разбить все страны на группы по значению переменной `fh`. Соответствие значений индекса типу страны -- см. в [таблице 3](https://freedomhouse.org/report/freedom-world-2016/methodology) в разделе Methodology на сайте Freedom House.

    *Подсказка:* в лекции в качестве условия мы использовали наличие паттерна (слова) в названиях регионов, но вместо этого можно указать "обычные" условия с помощью привычных `==`, `<`, `&` и так далее.

    Скомбинируйте дамми-переменные, чтобы получить переменную `fh_type`, которая принимает значения `not_free`, `partly_free`, `free`. Преобразуйте тип полученной переменной в факторный.

Анализ данных
-------------

1.  Определите, сколько стран разных типов (free, partly free, not free) в базе данных. Каких стран больше всего?

2.  Постройте график, который иллюстрировал бы ответ на первый вопрос (распределение стран по группам согласно классификации Freedom House). Приведите график в порядок: добавьте заголовок, скорректируйте оси и дайте им содержательные названия.

3.  Постройте ящики с усами для индекса Voice & Accountability по каждой группе стран (free, partly free, not free) на одном графике (см. семинар 6). Есть ли в какой-нибудь группе стран нетипичные значения индекса *Voice & Accountability*? Если есть, укажите в какой. Обоснуйте свой ответ.

4.  Поменяйте цвет графиков (покрасить все одним цветом или сделать три ящика разноцветными -- на Ваше усмотрение). Добавьте название графика, а также измените подписи к ящикам с усами по группам (поменяйте на "Free", "Not Free", "Partly Free").

5.  Постройте гистограмму для индекса *Control of Corruption*. Поменяйте ее цвет, добавьте заголовок и содержательные подписи к осям. Наложите на гистограмму график плотности нормального распределения с соответствующими параметрами. Как Вы считаете (основываясь на графике), является ли распределение индекса Control of Corruption нормальным?

6.  Проверьте формально (используя статистический критерий), является ли распределение индекса *Control of Corruption* нормальным. Запишите нулевую гипотезу, название используемого статистического критерия. Проинтерпретируйте полученный результат: сделайте статистический и содержательный вывод. Примеры выводов см. [здесь](https://github.com/allatambov/R-programming-4/tree/master/homeworks/hw4/interpretation.md).

7.  Постройте диаграмму рассеяния, которая иллюстрировала бы связь между показателями *Political Stability and Lack of Violence* и *Government Effectiveness*. Добавьте название графика и содержательные подписи к осям. Как Вы считаете (основываясь на графике), есть ли связь между этими показателями? Если да, укажите направление связи (прямая или обратная) и силу связи (сильная, слабая, средняя).

8.  Сделайте так, чтобы точки на диаграмме рассеяния из предыдущего пункта были полностью закрашены, а их цвета соответствовали типу государства по Freedom House (например, зеленые точки -- Free, красным -- Not Free, синим -- Partly Free). Добавьте на график сокращенные названия стран (`cnt_code`) так, чтобы посмотрев на точку, можно было понять, какой стране она соответствует.

    *Подсказка:* После строчки с `plot()` добавьте строчку с функцией `text()`. Пример:

    ``` r
    x <- seq(-4, 4)
    y <- x^2
    labs <- LETTERS[1:9]
    plot(x, y)
    text(x, y, labels = labs, pos = 4)
    ```

    Поправьте положение названий точек так, чтобы они не очень перекрывали друг друга (поэкспериментируйте с аргументами `pos` и `cex`, см. `help(text)`).

9.  Проверьте формально (используя статистический критерий), есть ли связь между показателями *Political Stability and Lack of Violence* и *Government Effectiveness*. Проинтерпретируйте полученный результат: сделайте статистический и содержательный вывод.

10. Используя функции из библиотеки `car`, постройте матрицу диаграмм рассеяния для всех индексов WGI (их 6). На главную диагональ матрицы поместите гистограммы для соотвествующих переменных. Не забудьте поправить в ячейках на главной диагонали названия переменных. Уберите с диаграмм рассеяния линию взвешенной регрессии (loess regression), оставьте только линию обычной линейной регрессии.

11. Постройте корреляционную матрицу для всех индексов WGI (их 6). Сохраните ее в переменную `M`.

12. Установите библиотеку `corrplot`. Посмотрите [документацию](https://cran.r-project.org/web/packages/corrplot/vignettes/corrplot-intro.html) по работе с ней.

13. Используя уже созданную корреляционную матрицу M, постройте график для визуализации значений коэффициентов корреляции в ней. Считайте, что нам нужен график с эллипсом рассеяния. Есть ли среди пар показателей такие пары, коэффициент корреляции между которыми отрицательный? Обоснуйте свой ответ.

14. Постройте аналогичный график, состоящий из закрашенных клеток, где более темные клетки соответствуют более высокому коэффициенту корреляции (оттенки клеток для отрицательных и положительных коэффициентов корреляции отличаются). Такой график называется *тепловой картой (heatmap)*.

15. Воспроизведите [график](https://github.com/allatambov/R-programming-4/tree/master/homeworks/hw4/corrm.png).

Между какими показателями коэффициент корреляции наибольший? Наименьший? Есть ли различные пары показателей, коэффициент корреляции для которых одинаков?

*Примечание:* Пары (x, y) и (y, x) считаются одинаковыми.
