---
title: "Статистические критерии"
author: "Алла Тамбовцева"
output: html_document
---
### Параметрические и непараметрические критерии 
Для формальной проверки статистических гипотез существуют различные статистические критерии. Их можно разделить на две большие группы: параметрические и непараметрические. 

**Параметрические критерии** основаны на том, что распределение данных известно. То есть, при применении какого-нибудь параметрического критерия нужно всегда следить за тем, что главное допущение критерия -- тип распределения -- выполняется.  Как правило, многие параметрические критерии предполагают нормальность распределения данных. Во многом это связано с тем, что нормальное распределение широко распространено. Кроме того, часто все, что мы можем сказать о распределении данных, это то, является ли оно нормальным или нет, потому что задача определения типа распределения довольно сложна и существующие формальные тесты могут определить лишь общий класс распределения или показать, "между какими" распределениями находится интересующее нас распределение.

**Непараметрические критерии** исходят из того, что распределение данных незвестно. Поэтому при использовании этих критериев часто действия производятся не с самими значениями в выборке/выборках, а с их рангами. 

То, что при применении тех или иных критериев нужно думать о распределении данных, не всегда означает, что перед их использованием нужно обязательно проверять распределение данных на нормальность. Иногда формальный критерий может показать, что гипотезу о нормальном распределении нужно отвергнуть, но распределение интересующего нас показателя может быть очень близким к нормальному. Поэтому главное исходить из формы распределения и тщательно анализировать данные на качественном уровне: правда ли, что показатель слишком часто принимает минимальное или максимальное значение (распределение скошено вправо или влево), правда ли, что из теоретических знаний об исследуемом показателе следует, что его распределение похоже на нормальное?

### Сравнение средних значений

#### Сравнение средних значений в двух группах

**Критерий Стьюдента для двух выборок (t-test)**

*Предположение:* выборки взяты из нормального распределения.

*Нулевая гипотеза:* средние двух генеральных совокупностей равны. 

*Варианты:* есть два варианта критерия Стьюдента: для независимых выборок (в двух выборках содержатся значения показателя для разных объектов) и для связных выборок (в двух выборках содержатся значения показателя для одних и тех же объектов, например, в разные периоды времени). Пример использования критерия Стьюдента для независимых выборок: сравнение средних значений ВВП на душу населения в демократиях и автократиях. Пример использования критерия Стьюдента для связных выборок: сравнение средней заработной платы в одних и тех же регионах до экономической реформы и после нее.

Строго говоря, есть еще одно деление внутри критерия Стьюдента для независимых выборок: при условии, что дисперсии генеральных совокупностей, из которых взяты выборки, равны, и при условии, что эти дисперсии не равны. В R по умолчанию встроена реализация второго варианта, так как это более реалистичное условие.

*Реализация в R:* 

Сравним средний уровень детской смертности в католических и протестантских кантонах Швейцарии (данные за 1888 год, встроенная в R база `swiss`). Предполагаем, что уровень смертности в католических и протестантских кантонах имеет нормальное распределение.

```{r}
# переменная religion - по которой будем делить кантоны на 2 группы
swiss$religion <- ifelse(swiss$Catholic > 50, "catholic", "protestant")
# сам тест
# через ~ указывается показатель, по которому делим наблюдения в базе на 2 группы
t.test(data = swiss, Infant.Mortality ~ religion)
```

Здесь `p-value = 0.2855`, значит, вероятность того, что наша нулевая гипотеза о равенстве средних верна (при условии имеющихся данных), равна 0.2855. На 5%-ном уровне значимости есть основания не отвергать нулевую гипотезу о равенстве средних значений (0.2855 > 0.05). Средний уровень детской смертности в католических и протестантских кантонах можно считать одинаковым.

Если вдруг в базе данных показатели, средние по которым нужно сравнить, просто находятся в двух разных столбцах, то t-test выглядит так:

```{r}
# вместо векторов могут быть столбцы базы через $
set.seed(123)
index.a <- rnorm(100, mean = 2, sd = 6)
index.b <- rnorm(100, mean = 10, sd = 10)
t.test(index.a, index.b)
```

Тут `p-value = 4.705e-08`, то есть почти 0. На 5%-ном уровне значимости есть основания отвергнуть нулевую гипотезу о равенстве средних значений.

Для связных выборок (парных показателей), в качестве аргумента функции `t.test` нужно дописать `paired=TRUE)`.

**Критерий Уилкоксона (Манна-Уитни) для двух групп**

*Предположение:* выборки взяты не из нормального распределения (из какого -- неизвестно).

*Нулевая гипотеза:* выборки взяты из одного и того же распределения (можно использовать как аналог t-test и говорить о равенстве средних двух независимых выборок, но изначально критерий Уилкоксона не об этом). 

*Варианты:* как и в случае с критерием Стьюдента для двух выборок, есть вариант для независимых и связных выборок.

*Реализация в R:* 

Сравним средний уровень детской смертности в католических и протестантских кантонах Швейцарии (данные за 1888 год, встроенная в R база `swiss`). Предполагаем, что уровень смертности в католических и протестантских кантонах имеет распределение, отличное от нормального.

```{r}
# через ~ указывается показатель, по которому делим наблюдения в базе на 2 группы
wilcox.test(data = swiss, Infant.Mortality ~ religion)
```

Если вылезает предупреждение "не могу подсчитать точное p-значение при наличии повторяющихся наблюдений", можно добавить аргумент `exact=FALSE`, что будет говорить R о том, что мы это понимаем, и не ждем от него  втаком случае точного расчета p-value.

Случай с двумя столбцам:
```{r}

wilcox.test(index.a, index.b)
```

#### Сравнение средних значений в трех и более группах

**ANOVA**

ANOVA -- analysis of variance, дисперсионный анализ.

*Предположение:* выборки взяты из нормального распределения.

*Нулевая гипотеза:* средние значения *k* генеральных совокупностей равны (где *k* -- число исследуемых выборок). 

*Реализация в R:* 

Сравним средний вес цыплят в пяти группах -- в зависимости от того, каким кормом их кормили (данные из встроенной в R базы `chickwts`). Предполагаем, что вес цыплят, относящихся к разным группам, имеет нормальное распределение.

```{r}
anova.res <- aov(data = chickwts, weight ~ feed) # ANOVA, выдает сумму квадратов
summary(anova.res) # все статистики + p-value
```

**Критерий Краскела-Уоллиса**

*Предположение:* выборки взяты из распределения, отличного от нормального (из какого -- неизвестно).

*Нулевая гипотеза:* выборки взяты из одного и того же распределения (можно говорить о равенстве средних *k* независимых выборок, но изначально критерий не об этом).

*Реализация в R:* 

Сравним средний вес цыплят в пяти группах -- в зависимости от того, каким кормом их кормили (данные из встроенной в R базы `chickwts`). Предполагаем, что вес цыплят, относящихся к разным группам, имеет распределение, отличное от нормального.
```{r}
kruskal.test(data = chickwts, weight ~ feed) 
```



